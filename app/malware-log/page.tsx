export const dynamic = 'force-static';

import ComponentWrapper from '@/components/component-wrapper';
import { Description, Heading } from '@/components/ui';
import { Calendar, Shield } from 'lucide-react';
import Link from 'next/link';
import { Metadata } from 'next';
import { wordpress } from '@/lib/wordpress';
import { formatWpDate } from '@/lib/utils';
import { notFound } from 'next/navigation';
import Image from 'next/image';

export const metadata: Metadata = {
  title: 'Malware Logs - MD Pabel | 3Zero Digital',
  description:
    'Detailed logs of malware discoveries, analyses, and remediations from client WordPress websites. Insights into common threats, infection locations, and cleanup strategies.',
  keywords:
    'WordPress malware logs, malware analysis, WordPress security threats, infection cleanup, phishing redirects, obfuscated JavaScript malware',
  alternates: {
    canonical: 'https://www.mdpabel.com/malware-log',
  },
  openGraph: {
    title: 'Malware Logs - MD Pabel | 3Zero Digital',
    description:
      'Explore real-world malware logs from WordPress sites, including detection, behavior analysis, and removal steps.',
    url: 'https://www.mdpabel.com/malware-log',
    siteName: 'MD Pabel',
    images: [
      {
        url: '/images/malware-log-opengraph-image.png', // Add a default OG image
        width: 1200,
        height: 630,
        alt: 'Malware Logs Collection',
      },
    ],
    locale: 'en_US',
    type: 'website',
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Malware Logs - MD Pabel | 3Zero Digital',
    description:
      'Logs of malware incidents on WordPress sites with detailed analysis and fixes.',
    images: ['/images/malware-log-opengraph-image.png'],
    site: '@mdpabe11',
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
};

const MalwareLogListPage = async () => {
  const { posts, total } = await wordpress.getPosts({
    postType: 'malware-log',
    status: 'publish',
  });

  if (!posts || posts.length === 0) {
    return notFound();
  }

  return (
    <div>
      <ComponentWrapper>
        <div className='mb-12 text-center'>
          <Heading>Malware Logs</Heading>
          <Description className='mx-auto mt-4 max-w-2xl text-slate-300'>
            Explore our curated collection of malware logs, providing insights
            into various threats affecting WordPress sites and how to mitigate
            them.
          </Description>
        </div>

        <div className='space-y-8'>
          {posts.map((log) => (
            <article
              key={log.id}
              className='hover:shadow-md p-6 border border-slate-700 rounded-lg transition-shadow duration-300'>
              <div className='flex md:flex-row flex-col gap-6'>
                {log.acf?.screenshot && log.acf.screenshot[0]?.url && (
                  <div className='md:w-1/3'>
                    <div className='relative rounded-md h-40 overflow-hidden'>
                      <Image
                        src={log.acf.screenshot[0].url}
                        alt={`Screenshot for ${log.title}`}
                        fill
                        className='object-cover'
                      />
                    </div>
                  </div>
                )}
                <div className='flex-1'>
                  <h4 className='mb-2 font-semibold text-slate-200 text-xl'>
                    <Link
                      href={`/malware-log/${log.slug}`}
                      className='hover:text-purple-400 transition-colors'
                      dangerouslySetInnerHTML={{ __html: log.title }}></Link>
                  </h4>
                  <p
                    className='mb-4 text-slate-400 line-clamp-3'
                    dangerouslySetInnerHTML={{
                      __html:
                        log.acf?.issue_reported || log.excerpt || log.content,
                    }}></p>
                  <div className='flex justify-between items-center text-slate-500 text-sm'>
                    <span className='flex items-center gap-1'>
                      <Calendar className='w-4 h-4' />
                      {formatWpDate(log.date)}
                    </span>
                    <Link
                      href={`/malware-log/${log.slug}`}
                      className='flex items-center gap-1 text-purple-400 hover:text-purple-300 transition-colors'>
                      View Details
                      <Shield className='w-4 h-4' />
                    </Link>
                  </div>
                </div>
              </div>
            </article>
          ))}
        </div>
      </ComponentWrapper>

      <script
        type='application/ld+json'
        dangerouslySetInnerHTML={{
          __html: JSON.stringify({
            '@context': 'https://schema.org',
            '@type': 'CollectionPage',
            name: 'Malware Logs - MD Pabel | 3Zero Digital',
            description:
              'Collection of malware logs from WordPress sites with analysis and remediation details.',
            url: 'https://www.mdpabel.com/malware-log',
            breadcrumb: {
              '@type': 'BreadcrumbList',
              itemListElement: [
                {
                  '@type': 'ListItem',
                  position: 1,
                  name: 'Home',
                  item: 'https://www.mdpabel.com/',
                },
                {
                  '@type': 'ListItem',
                  position: 2,
                  name: 'Malware Log',
                  item: 'https://www.mdpabel.com/malware-log',
                },
              ],
            },
            hasPart: posts.map((post) => ({
              '@type': 'CreativeWork',
              headline: post.title,
              datePublished: post.date,
              url: `https://www.mdpabel.com/malware-log/${post.slug}`,
              description: (
                post.acf?.issue_reported ||
                post.excerpt ||
                post.content
              ).replace(/<[^>]*>/g, ''),
              author: {
                '@type': 'Person',
                name: post.author?.name || 'MD Pabel Team',
              },
              publisher: {
                '@type': 'Organization',
                name: 'MD Pabel',
                logo: {
                  '@type': 'ImageObject',
                  url: 'https://www.mdpabel.com/images/malware-log-opengraph-image.png',
                },
              },
            })),
          }),
        }}
      />
    </div>
  );
};

export default MalwareLogListPage;
