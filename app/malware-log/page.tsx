export const dynamic = 'force-static';

import ComponentWrapper from '@/components/component-wrapper';
import { Description, Heading } from '@/components/ui';
import { Calendar, Shield } from 'lucide-react';
import Link from 'next/link';
import React from 'react';
import { Metadata } from 'next';
import { wordpress } from '@/lib/wordpress';
import { formatWpDate } from '@/lib/utils';

export const metadata: Metadata = {
  title: 'Malware Log - MD Pabel | 3Zero Digital',
  description: 'List of detailed malware discovery logs from client websites.',
};

export async function generateStaticParams() {
  const { posts } = await wordpress.getPosts({
    postType: 'malware-log',
    status: 'publish',
  });

  if (!posts || posts.length === 0) {
    return [];
  }

  // Map the slugs of the posts to the params object
  return posts.map((post) => ({
    slug: post.slug,
  }));
}

const MalwareLogListPage = async () => {
  const { posts, total, totalPages, hasMore } = await wordpress.getPosts({
    postType: 'malware-log',
    status: 'publish',
  });

  return (
    <ComponentWrapper>
      <div className='relative pt-20 pb-16 text-center'>
        <Heading className='mb-6'>Malware Discovery Logs</Heading>
        <Description>
          A collection of detailed analyses from security incidents in client
          websites. Select a log to view full details.
        </Description>
      </div>

      <div className='space-y-6 mb-16'>
        {posts.map((report) => (
          <Link
            key={report.slug}
            href={`/malware-log/${report.slug}`}
            className='block bg-slate-800/50 p-6 border border-slate-700 rounded-xl'>
            <div className='flex items-center gap-4 mb-4'>
              <Shield className='w-8 h-8 text-red-400' />
              <h3 className='font-bold text-white text-xl'>{report.title}</h3>
            </div>
            <p
              className='mb-4 text-slate-300'
              dangerouslySetInnerHTML={{
                __html: report.content,
              }}
            />
            <div className='flex items-center gap-2 text-slate-400'>
              <Calendar className='w-4 h-4' />
              <span>{formatWpDate(report.date)}</span>
            </div>
          </Link>
        ))}
      </div>
    </ComponentWrapper>
  );
};

export default MalwareLogListPage;
